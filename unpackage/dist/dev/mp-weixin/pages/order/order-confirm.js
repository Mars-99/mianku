(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/order-confirm"],{289:function(e,t,n){"use strict";(function(e){n(5);i(n(3));var t=i(n(290));function i(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n(1)["createPage"])},290:function(e,t,n){"use strict";n.r(t);var i=n(291),o=n(293);for(var r in o)"default"!==r&&function(e){n.d(t,e,(function(){return o[e]}))}(r);n(295);var c,s=n(11),a=Object(s["default"])(o["default"],i["render"],i["staticRenderFns"],!1,null,"243e8152",null,!1,i["components"],c);a.options.__file="pages/order/order-confirm.vue",t["default"]=a.exports},291:function(e,t,n){"use strict";n.r(t);var i=n(292);n.d(t,"render",(function(){return i["render"]})),n.d(t,"staticRenderFns",(function(){return i["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return i["recyclableRender"]})),n.d(t,"components",(function(){return i["components"]}))},292:function(e,t,n){"use strict";var i;n.r(t),n.d(t,"render",(function(){return o})),n.d(t,"staticRenderFns",(function(){return c})),n.d(t,"recyclableRender",(function(){return r})),n.d(t,"components",(function(){return i}));try{i={uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,534))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.pageshow?null:e.__map(e.checkedLodgerList,(function(t,n){var i=e.__get_orig(t),o=e.checkedLodgerList.length?t.phone.replace(/(\d{3})\d*(\d{4})/,"$1****$2"):null;return{$orig:i,g0:o}})));e.$mp.data=Object.assign({},{$root:{l0:n}})},r=!1,c=[];o._withStripped=!0},293:function(e,t,n){"use strict";n.r(t);var i=n(294),o=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=o.a},294:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(19)),o=n(14);function r(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n,i,o,r,c){try{var s=e[r](c),a=s.value}catch(u){return void n(u)}s.done?t(a):Promise.resolve(a).then(i,o)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function s(e){c(r,i,o,s,a,"next",e)}function a(e){c(r,i,o,s,a,"throw",e)}s(void 0)}))}}var a=function(){n.e("components/pageLoad/pageLoad").then(function(){return resolve(n(499))}.bind(null,n)).catch(n.oe)},u={components:{pageLoad:a},data:function(){return{pageshow:!0,checkIn:0,checkOut:0,checkInYH:0,checkOutYH:0,dayCount:1,totalPice:null,listingsDetail:[],lodger:[],checkedLodgerList:[],arriveAt:"",couponId:-1,orderNumber:0,payPice:0,userDetail:{},couponList:[],canUseCoupon:[],isCoupon:-1,couponPice:null}},onLoad:function(){this.init()},onShow:function(){var t=getCurrentPages(),n=t[t.length-1];this.brand=n.brand,this.brand&&(this.brand.checkedLodgerList&&(this.checkedLodgerList=this.brand.checkedLodgerList.map((function(e){return{contacts:e.contacts,cardType:e.cardType,phone:e.phone,idCard:e.idCard}})),console.log("this.checkedLodgerList",this.checkedLodgerList)),this.checkedLodgerList.length>this.listingsDetail.hotel.bedNum&&(this.checkedLodgerList=[],e.showToast({icon:"none",title:"入住人数不可大于可住人数",duration:2e3,position:"top"})),console.log("checkedLodgerList",this.checkedLodgerList))},methods:{init:function(){var e=this;return s(i.default.mark((function t(){var n,r,c,s;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,o.hotelDetail)(Number(e.$mp.query.id));case 2:return n=t.sent,r=n.data,e.checkIn=e.$mp.query.checkIn,e.checkOut=e.$mp.query.checkOut,e.checkInYH=e.checkIn.slice(5),e.checkOutYH=e.checkOut.slice(5),e.dayCount=e.$mp.query.dayCount,e.totalPice=e.$mp.query.totalPice,e.listingsDetail=r.data,e.pageshow=!1,t.next=14,(0,o.userDetail)();case 14:c=t.sent,s=c.data,e.userDetail=s.data,console.log("this.userDetail",e.userDetail),e.countPice(),e.getCoupon();case 20:case"end":return t.stop()}}),t)})))()},countPice:function(){0==this.userDetail.isFirst&&(this.listingsDetail.hotel.firstReduce=0),1==this.userDetail.examine?this.couponPice%1===0?(this.payPice=.95*(Number(this.totalPice)-Number(this.couponPice)+Number(this.listingsDetail.hotel.cleaningFee)-Number(this.listingsDetail.hotel.firstReduce)),this.payPice=this.payPice.toFixed(2)):(this.payPice=.95*(Number(this.totalPice)*Number(this.couponPice)+Number(this.listingsDetail.hotel.cleaningFee)-Number(this.listingsDetail.hotel.firstReduce)),this.payPice=this.payPice.toFixed(2)):this.couponPice%1===0?(this.payPice=Number(this.totalPice)+Number(this.listingsDetail.hotel.cleaningFee)-Number(this.listingsDetail.hotel.firstReduce)-Number(this.couponPice),this.payPice=this.payPice.toFixed(2)):(this.payPice=Number(this.totalPice)*Number(this.couponPice)+Number(this.listingsDetail.hotel.cleaningFee)-Number(this.listingsDetail.hotel.firstReduce),this.payPice=this.payPice.toFixed(2)),console.log("aaa",this.couponPice)},getCoupon:function(){var e=this;return s(i.default.mark((function t(){var n,r,c;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,o.getCouponList)(0);case 2:if(n=t.sent,r=n.data,1!=r.code){t.next=8;break}return t.abrupt("return",e.$api.msg(r.msg));case 8:e.couponList=r.data.rs,c=[],e.couponList.forEach((function(t){if((0===t.cityId||t.cityId===e.listingsDetail.hotel.cityId)&&(0===t.type&&1===e.listingsDetail.hotel.coupon0||1===t.type&&1===e.listingsDetail.hotel.coupon1||2===t.type&&1===e.listingsDetail.hotel.coupon2)){var n=null;if(t.gids){var i=t.gids.split(",");n=i.find((function(t){return Number(t)===e.listingsDetail.hotel.id}))}(0===t.gType||1===t.gType&&n)&&(0===t.restrict||e.totalPice>=t.restrict)&&c.push(t)}})),e.canUseCoupon=c;case 12:case"end":return t.stop()}}),t)})))()},openCoupon:function(){this.$refs.popup.open("bottom")},selectCoupon:function(e,t){this.isCoupon=t,this.couponId=e.id,2==e.type?(this.couponPice=e.discount/10,console.log("this.couponPice1",this.couponPice)):(this.couponPice=e.deduct,console.log("this.couponPice2",this.couponPice)),this.countPice(),this.$refs.popup.close()},openLodgerPage:function(){e.navigateTo({url:"../order/lodger-list"})},booking:function(){var e=this;return s(i.default.mark((function t(){var n,r;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,o.booking)(e.listingsDetail.hotel.id,e.couponId,e.listingsDetail.hotel.bedNum,e.checkedLodgerList[0].contacts,e.checkedLodgerList[0].phone,e.checkIn,e.checkOut,e.checkIn,e.checkedLodgerList);case 2:if(n=t.sent,r=n.data,1!=r.code){t.next=8;break}return t.abrupt("return",e.$api.msg(r.msg));case 8:e.orderNumber=r.data.id,console.log("this.orderNumber",e.orderNumber),e.payWX(e.orderNumber),console.log("res",r);case 12:case"end":return t.stop()}}),t)})))()},payWX:function(t){var n=this;return s(i.default.mark((function r(){var c,s;return i.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,(0,o.payWX)(t);case 2:if(c=i.sent,s=c.data,1!=s.code){i.next=8;break}return i.abrupt("return",n.$api.msg(s.msg));case 8:e.requestPayment({provider:"wxpay",timeStamp:s.data.timeStamp,nonceStr:s.data.nonceStr,package:s.data.packageValue,signType:s.data.signType,paySign:s.data.paySign,success:function(t){e.navigateTo({url:"../order/order-result?state=success"}),console.log("success:"+JSON.stringify(t))},fail:function(t){e.navigateTo({url:"../order/order-result?state=fail"}),console.log("fail:"+JSON.stringify(t))}});case 9:case"end":return i.stop()}}),r)})))()},submitOrders:function(){0!=this.checkedLodgerList.length?this.booking():e.showToast({icon:"none",title:"请添加入住人",duration:2e3,position:"top"})}}};t.default=u}).call(this,n(1)["default"])},295:function(e,t,n){"use strict";n.r(t);var i=n(296),o=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=o.a},296:function(e,t,n){}},[[289,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/order/order-confirm.js.map