(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/listings/listings-detail"],{253:function(e,t,i){"use strict";(function(e){i(5);n(i(3));var t=n(i(254));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=i,e(t.default)}).call(this,i(1)["createPage"])},254:function(e,t,i){"use strict";i.r(t);var n=i(255),r=i(257);for(var a in r)"default"!==a&&function(e){i.d(t,e,(function(){return r[e]}))}(a);i(260);var o,c=i(11),s=Object(c["default"])(r["default"],n["render"],n["staticRenderFns"],!1,null,"a7cd7c70",null,!1,n["components"],o);s.options.__file="pages/listings/listings-detail.vue",t["default"]=s.exports},255:function(e,t,i){"use strict";i.r(t);var n=i(256);i.d(t,"render",(function(){return n["render"]})),i.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]})),i.d(t,"recyclableRender",(function(){return n["recyclableRender"]})),i.d(t,"components",(function(){return n["components"]}))},256:function(e,t,i){"use strict";var n;i.r(t),i.d(t,"render",(function(){return r})),i.d(t,"staticRenderFns",(function(){return o})),i.d(t,"recyclableRender",(function(){return a})),i.d(t,"components",(function(){return n}));try{n={uniSwiperDot:function(){return i.e("uni_modules/uni-swiper-dot/components/uni-swiper-dot/uni-swiper-dot").then(i.bind(null,442))},uniIcons:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(i.bind(null,484))},uniTitle:function(){return i.e("uni_modules/uni-title/components/uni-title/uni-title").then(i.bind(null,449))},uniPopup:function(){return i.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(i.bind(null,534))}}}catch(c){if(-1===c.message.indexOf("Cannot find module")||-1===c.message.indexOf(".vue"))throw c;console.error(c.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var r=function(){var e=this,t=e.$createElement,i=(e._self._c,e.pageshow?null:e.__map(e.flag,(function(t,i){var n=e.__get_orig(t),r=t?e._f("flag")(t):null;return{$orig:n,f0:r}}))),n=e.pageshow?null:e.listingsDetail.hotel.infrastructure.indexOf("投影仪"),r=e.pageshow?null:e.listingsDetail.hotel.tag.indexOf("近地铁"),a=e.pageshow?null:e.listingsDetail.hotel.service.indexOf("自主入住"),o=e.pageshow?null:e.listingsDetail.hotel.rules.indexOf("允许聚会");e.$mp.data=Object.assign({},{$root:{l0:i,g0:n,g1:r,g2:a,g3:o}})},a=!1,o=[];r._withStripped=!0},257:function(e,t,i){"use strict";i.r(t);var n=i(258),r=i.n(n);for(var a in n)"default"!==a&&function(e){i.d(t,e,(function(){return n[e]}))}(a);t["default"]=r.a},258:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=c(i(19)),r=i(13),a=i(14),o=(c(i(259)),c(i(65)));function c(e){return e&&e.__esModule?e:{default:e}}function s(e,t,i,n,r,a,o){try{var c=e[a](o),s=c.value}catch(l){return void i(l)}c.done?t(s):Promise.resolve(s).then(n,r)}function l(e){return function(){var t=this,i=arguments;return new Promise((function(n,r){var a=e.apply(t,i);function o(e){s(a,n,r,o,c,"next",e)}function c(e){s(a,n,r,o,c,"throw",e)}o(void 0)}))}}function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function h(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(Object(i),!0).forEach((function(t){d(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function d(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var f=function(){i.e("components/pageLoad/pageLoad").then(function(){return resolve(i(499))}.bind(null,i)).catch(i.oe)},g={components:{pageLoad:f},data:function(){return{curID:0,current:0,mode:"round",choicCurrentIndex:0,title:"map",key:"46ABZ-J7NCF-F4HJ4-N2TB6-T5636-7OBA3",latitude:0,longitude:0,markers:[{width:30,height:30,latitude:0,longitude:0,iconPath:"https://mkhotel.oss-cn-shanghai.aliyuncs.com/static/image/map-icon.png",callout:{content:"",borderRadius:5,display:"ALWAYS",padding:7,bgColor:"#FFFFFF",textAlign:"center"}}],listingsDetail:[],flag:[],security:[],service:[],tag:[],infrastructure:[],swiperheight:0,show:!1,week:0,check:[],pageshow:!0,checkIn:0,checkOut:0,checkInYH:0,checkOutYH:0,dayCount:1,unitPrice:0,originalPrice:0,brand:0,choiceDateArr:[],totalPice:0,isCollect:-1,collectionList:[],freeTrialPage:"",freeTrialShow:!1,isApply:!1,orderDate:[],newArrDate:[],assign:[],wufang:!1,couponList:[],share:{title:"眠库小程序",path:"/pages/index/index",imageUrl:"",desc:"",content:""}}},filters:{flag:function(e){switch(e){case"h":return"首单立减";case"c":return"今日特价";case"j":return"新房优惠";default:break}}},mounted:function(){var t=this;e.getSystemInfo({success:function(e){t.swiperheight=e.windowHeight}})},computed:h({},(0,r.mapGetters)(["getUserinfo","getNeedAuth","getIsLogin"])),onLoad:function(){this.getWeeK(),this.getHotelDetail()},onShow:function(){var e=getCurrentPages(),t=e[e.length-1];this.brand=t.brand,this.brand&&this.brand.choiceDate&&(this.checkIn=this.brand.choiceDate[0].re,this.checkOut=this.brand.choiceDate[1].re,this.dayCount=this.brand.dayCount,this.checkInYH=this.checkIn.slice(5),this.checkOutYH=this.checkOut.slice(5),this.choiceDateArr=this.brand.choiceDateArr,this.getTotalPice(),this.listingStatus())},methods:{getHotelDetail:function(){var t=this;return l(n.default.mark((function i(){var r,o,c,s;return n.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,(0,a.hotelDetail)(Number(t.$mp.query.id));case 2:r=i.sent,o=r.data,t.checkIn=t.$mp.query.checkIn,t.checkOut=t.$mp.query.checkOut,t.$mp.query.dayCount&&(t.dayCount=t.$mp.query.dayCount),t.checkOut||t.checkIn?(t.checkInYH=t.checkIn.slice(5),t.checkOutYH=t.checkOut.slice(5)):t.getTimeandWeek(),t.freeTrialPage=t.$mp.query.pageRoot,t.freeTrial(),t.$mp.query.choiceDateArr&&(t.choiceDateArr=JSON.parse(decodeURIComponent(t.$mp.query.choiceDateArr))),t.listingsDetail=o.data,t.orderDate=o.data.onOrder,t.assign=o.data.assign,t.couponList=o.data.beforeCoupon,e.request({url:"https://apis.map.qq.com/ws/geocoder/v1/?address="+t.listingsDetail.hotel.address+"&key="+t.key,success:function(e){console.log("res",e),t.latitude=e.data.result.location.lat,t.longitude=e.data.result.location.lng,t.markers[0].latitude=t.latitude,t.markers[0].longitude=t.longitude}}),t.markers[0].callout.content=o.data.hotel.address,t.getCollectionList(0),t.dealPrice(),t.getTotalPice(),t.flag=o.data.hotel.flag.split(","),t.security=o.data.hotel.security.split(","),t.service=o.data.hotel.service.split(","),t.tag=o.data.hotel.tag.split(","),t.infrastructure=o.data.hotel.infrastructure.split(","),t.pageshow=!1,c=e.getStorageSync("history_list"),c?(s=c.find((function(e){return e.id===o.data.hotel.id})),s||c.unshift(o.data.hotel)):(c=[],c.unshift(o.data.hotel)),c.length>10&&c.pop(),t.Share(),e.setStorageSync("history_list",c),t.listingStatus();case 32:case"end":return i.stop()}}),i)})))()},change:function(e){this.current=e.detail.current},openM:function(e){this.show=e.show},openListingsDetail:function(t){this.checkIn=this.checkIn,this.checkOut=this.checkOut;var i=encodeURIComponent(JSON.stringify(this.choiceDateArr));e.navigateTo({url:"../listings/listings-detail?id="+t.id+"&checkIn="+this.checkIn+"&checkOut="+this.checkOut+"&dayCount="+this.dayCount+"&choiceDateArr="+i})},openDetailMap:function(){var t=JSON.stringify(this.markers);e.navigateTo({url:"../listings/detail-map?markers="+t})},openNavigationMap:function(){var t=JSON.stringify(this.markers);e.navigateTo({url:"../listings/navigation-map?markers="+t})},openOrderConfirm:function(){var t=e.getStorageSync("loginAuth");if(!t)return this.$api.msg("请先登录"),void this.$api.href("../login/login");this.checkIn=this.checkIn,this.checkOut=this.checkOut,e.navigateTo({url:"../order/order-confirm?id="+this.listingsDetail.hotel.id+"&checkIn="+this.checkIn+"&checkOut="+this.checkOut+"&dayCount="+this.dayCount+"&totalPice="+this.totalPice})},open:function(e){this.$refs.popup.open("bottom")},dealPrice:function(){var e=(0,o.default)().format("YYYY-MM-DD"),t=this.assign.find((function(t){return t.hDate==e}));if(t)this.unitPrice=t.activityPrice,this.originalPrice=t.originalCost;else{var i=(0,o.default)().format("d");5==i||6==i?(this.unitPrice=this.listingsDetail.hotel.weekendActivity,this.originalPrice=this.listingsDetail.hotel.weekendOriginal):(this.unitPrice=this.listingsDetail.hotel.weekdaysActivity,this.originalPrice=this.listingsDetail.hotel.weekdaysOriginal)}},call_phone:function(){e.makePhoneCall({phoneNumber:"15364037300",success:function(e){console.log("调用成功!")},fail:function(e){console.log("调用失败!")}})},moveStop:function(){},getWeeK:function(){var e=new Date,t=e.getDay(e);this.week=t},selectDate:function(){var t=JSON.stringify(this.orderDate),i=JSON.stringify(this.assign);e.navigateTo({url:"../select-date/select-date?pageSource=listingsDetail&weekendActivity="+this.listingsDetail.hotel.weekendActivity+"&weekdaysActivity="+this.listingsDetail.hotel.weekdaysActivity+"&orderDate="+t+"&assign="+i})},getTimeandWeek:function(){for(var e=new Date,t=0;t<7;t++){var i=new Date(e.getTime()+24*t*3600*1e3),n=i.getFullYear(),r=i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1,a=i.getDate()<10?"0"+i.getDate():i.getDate(),o=new Date(e.getTime()+24*t*3600*1e3),c=["星期天","星期一","星期二","星期三","星期四","星期五","星期六"];this.check.push({date:n+"-"+r+"-"+a,week:c[o.getDay()],checked:!1})}this.checkIn=this.check[0].date,this.checkOut=this.check[1].date,this.checkInYH=this.check[0].date.slice(5),this.checkOutYH=this.check[1].date.slice(5)},getTotalPice:function(){var e=this;if(this.choiceDateArr.length>0){this.choiceDateArr.forEach((function(t){var i=e.listingsDetail.assign.find((function(e){return e.hDate==t.re}));i?t.price=i.activityPrice:"五"==t.week||"六"==t.week?t.price=e.listingsDetail.hotel.weekendActivity:t.price=e.listingsDetail.hotel.weekdaysActivity})),this.totalPice=null;for(var t=0;t<this.choiceDateArr.length-1;t++)this.totalPice+=this.choiceDateArr[t].price;this.totalPice=this.totalPice.toFixed(2)}else this.totalPice=this.unitPrice},getUserCollection:function(){var t=this;return l(n.default.mark((function i(){var r,o,c;return n.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(t.isCollect,r=e.getStorageSync("loginAuth"),r){i.next=6;break}return t.$api.msg("请先登录"),t.$api.href("../login/login"),i.abrupt("return");case 6:return i.next=8,(0,a.getUserCollection)(t.listingsDetail.hotel.id,0);case 8:o=i.sent,c=o.data,1==c.code&&t.$api.msg(c.code.msg),0==t.isCollect?t.isCollect=-1:t.isCollect=0;case 12:case"end":return i.stop()}}),i)})))()},getCollectionList:function(t){var i=this;return l(n.default.mark((function r(){var o,c,s,l;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.getStorageSync("loginAuth"),!o){n.next=17;break}return n.next=4,(0,a.getCollectionList)(t);case 4:if(c=n.sent,s=c.data,1!=s.code){n.next=10;break}i.$api.msg(data.code.msg),n.next=17;break;case 10:if(i.collectionList=s.data.rs,l=i.collectionList.find((function(e){return e.cid==i.listingsDetail.hotel.id})),!l){n.next=16;break}l.cid==i.listingsDetail.hotel.id?i.isCollect=0:i.isCollect=-1,n.next=17;break;case 16:return n.abrupt("return");case 17:case"end":return n.stop()}}),r)})))()},freeTrial:function(){if("试睡"==this.freeTrialPage){this.freeTrialShow=!0;var e=this.$mp.query.state;1==e&&(this.isApply=!0)}else this.freeTrialShow=!1},freeTrialClose:function(){this.freeTrialShow=!1},freeTrialApply:function(t){var i=this;return l(n.default.mark((function r(){var o,c,s,l;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!i.isApply){n.next=4;break}e.navigateTo({url:"../free-trial/free-trial-result?id="+i.listingsDetail.hotel.id}),n.next=13;break;case 4:return n.next=6,(0,a.userDetail)();case 6:return o=n.sent,c=o.data,n.next=10,(0,a.activityEnroll)(t,c.data.userName,c.data.phone);case 10:s=n.sent,l=s.data,1==l.code?e.showToast({icon:"none",title:l.msg,duration:2e3,position:"top"}):e.navigateTo({url:"../free-trial/free-trial-result?id="+i.listingsDetail.hotel.id});case 13:case"end":return n.stop()}}),r)})))()},Share:function(){this.share.title=this.listingsDetail.hotel.hotelName,this.share.path="@/listings/listings-detail?id="+this.listingsDetail.hotel.id,this.share.imageUrl=this.listingsDetail.hotel.thum},getdiffdate:function(e,t){var i=new Array,n=0;while(e<=t){i[n]=e;var r=new Date(e).getTime(),a=r+864e5,o=new Date(a).getFullYear()+"-",c=new Date(a).getMonth()+1<10?"0"+(new Date(a).getMonth()+1)+"-":new Date(a).getMonth()+1+"-",s=new Date(a).getDate()<10?"0"+new Date(a).getDate():new Date(a).getDate();e=o+c+s,n++}return i.pop(),i},listingStatus:function(){var e=this;if(this.orderDate.length>0){var t=this.orderDate,i=[],n=[];t.forEach((function(e){i.push({checkIn:e.checkIn,checkOut:e.checkOut})})),i.forEach((function(t){n+=e.getdiffdate(t.checkIn,t.checkOut)+","})),n&&(this.newArrDate=n.split(","));var r=this.choiceDateArr.concat();r.pop(),r.forEach((function(t){var i=e.newArrDate.find((function(e){return e==t.re}));i&&(e.wufang=!0)}));var a=this.newArrDate.find((function(t){return t==e.checkIn}));a&&(this.wufang=!0)}},receiveCoupon:function(t){var i=this;return l(n.default.mark((function r(){var o,c;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,(0,a.getCoupon)(t);case 2:o=n.sent,c=o.data,1==c.code?(i.$api.msg(c.code.msg),e.showToast({icon:"none",title:c.msg,duration:2e3,position:"top"})):e.showToast({icon:"none",title:"领取成功",duration:2e3,position:"top"});case 5:case"end":return n.stop()}}),r)})))()},openLocation:function(){var t=this.markers,i=t.latitude,n=t.longitude,r=t.name;e.openLocation({latitude:i,longitude:n,name:r,fail:function(){e.showModal({content:"打开地图失败,请重"})}})}}};t.default=g}).call(this,i(1)["default"])},260:function(e,t,i){"use strict";i.r(t);var n=i(261),r=i.n(n);for(var a in n)"default"!==a&&function(e){i.d(t,e,(function(){return n[e]}))}(a);t["default"]=r.a},261:function(e,t,i){}},[[253,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/listings/listings-detail.js.map